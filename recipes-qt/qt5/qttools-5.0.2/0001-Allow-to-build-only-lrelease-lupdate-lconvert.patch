From f5d7b5cd073eb6b5a60658b9622c59a682fd828d Mon Sep 17 00:00:00 2001
From: Martin Jansa <Martin.jansa@gmail.com>
Date: Wed, 11 Sep 2013 18:30:08 +0200
Subject: [PATCH] Allow to build only lrelease + lupdate + lconvert

This is useful e.g. when cross compiling with OpenEmbedded where qtbase-native
is built without GUI support (no-png is set) and we still want to build
native lrelease + lupdate + lconvert tools.

Upstream-Status: Pending

Signed-off-by: Martin Jansa <Martin.jansa@gmail.com>
---
 examples/examples.pro     |    4 ++--
 src/designer/src/src.pro  |   14 ++++++++------
 src/linguist/linguist.pro |    2 +-
 src/src.pro               |   10 ++++++----
 tests/auto/auto.pro       |   20 +++++++++++---------
 5 files changed, 28 insertions(+), 22 deletions(-)

diff --git a/examples/examples.pro b/examples/examples.pro
index 4955969..8e86419 100644
--- a/examples/examples.pro
+++ b/examples/examples.pro
@@ -1,3 +1,3 @@
 TEMPLATE = subdirs
-qtHaveModule(widgets): SUBDIRS += help designer linguist uitools assistant
-
+!linguistonly:qtHaveModule(widgets): SUBDIRS += help designer assistant
+qtHaveModule(widgets): SUBDIRS += linguist uitools
diff --git a/src/designer/src/src.pro b/src/designer/src/src.pro
index 64d1c37..6e6912d 100644
--- a/src/designer/src/src.pro
+++ b/src/designer/src/src.pro
@@ -1,10 +1,12 @@
 TEMPLATE = subdirs
 CONFIG += ordered
 
-SUBDIRS = \
-    uitools \
-    lib \
-    components \
-    designer
+!linguistonly {
+    SUBDIRS = \
+        lib \
+        components \
+        designer
+}
+SUBDIRS += uitools
 
-contains(QT_CONFIG, shared): SUBDIRS += plugins
+!linguistonly:contains(QT_CONFIG, shared): SUBDIRS += plugins
diff --git a/src/linguist/linguist.pro b/src/linguist/linguist.pro
index 04b0ab6..8c63bb4 100644
--- a/src/linguist/linguist.pro
+++ b/src/linguist/linguist.pro
@@ -3,7 +3,7 @@ SUBDIRS  = \
     lrelease \
     lupdate \
     lconvert
-!no-png:qtHaveModule(widgets): SUBDIRS += linguist
+!linguistonly:!no-png:qtHaveModule(widgets): SUBDIRS += linguist
 
 win32:CMAKE_BIN_SUFFIX = ".exe"
 
diff --git a/src/src.pro b/src/src.pro
index 3799567..7deb785 100644
--- a/src/src.pro
+++ b/src/src.pro
@@ -5,10 +5,12 @@ qtHaveModule(widgets) {
     no-png {
         message("Some graphics-related tools are unavailable without PNG support")
     } else {
-        SUBDIRS = assistant \
+        !linguistonly { 
+            SUBDIRS = assistant \
                   pixeltool \
-                  qtestlib \
-                  designer
+                  qtestlib
+        }
+        SUBDIRS += designer
 #    unix:!mac:!embedded:!qpa:SUBDIRS += qtconfig
     }
 }
@@ -21,7 +23,7 @@ mac {
 
 embedded:SUBDIRS += kmap2qmap
 
-qtHaveModule(dbus): SUBDIRS += qdbus
+!linguistonly:qtHaveModule(dbus): SUBDIRS += qdbus
 # We don't need these command line utilities on embedded platforms.
 embedded: SUBDIRS += makeqpf
 
diff --git a/tests/auto/auto.pro b/tests/auto/auto.pro
index 074aa34..d38e05d 100644
--- a/tests/auto/auto.pro
+++ b/tests/auto/auto.pro
@@ -1,13 +1,15 @@
 TEMPLATE=subdirs
-SUBDIRS=\
-    linguist \
-    host.pro \
-    qhelpcontentmodel \
-    qhelpenginecore \
-    qhelpgenerator \
-    qhelpindexmodel \
-    qhelpprojectdata \
-    cmake
+!linguistonly {
+    SUBDIRS=\
+        linguist \
+        host.pro \
+        qhelpcontentmodel \
+        qhelpenginecore \
+        qhelpgenerator \
+        qhelpindexmodel \
+        qhelpprojectdata \
+        cmake
+}
 
 # These tests don't make sense for cross-compiled builds
 cross_compile:SUBDIRS -= host.pro
-- 
1.7.10.4

