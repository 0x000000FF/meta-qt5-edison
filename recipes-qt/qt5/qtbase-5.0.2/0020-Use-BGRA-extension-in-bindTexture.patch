From 87380175cdb88ceadeec5773d8bc40ec08c4e3d6 Mon Sep 17 00:00:00 2001
From: Jani Hautakangas <jani.hautakangas@ixonos.com>
Date: Mon, 27 May 2013 15:25:25 -0700
Subject: [PATCH 20/22] Use BGRA extension in bindTexture

Upstream-Status: Pending

Change-Id: I18aecc87c5c7d4483cabe5555da33ca6bb8580f1
---
 src/gui/opengl/qopengltexturecache.cpp | 6 ++----
 1 file changed, 2 insertions(+), 4 deletions(-)

diff --git a/src/gui/opengl/qopengltexturecache.cpp b/src/gui/opengl/qopengltexturecache.cpp
index fffc368..11c8b59 100644
--- a/src/gui/opengl/qopengltexturecache.cpp
+++ b/src/gui/opengl/qopengltexturecache.cpp
@@ -171,7 +171,7 @@ static inline void qgl_byteSwapImage(QImage &img)
         }
     }
 }
-
+#include <QDebug>
 GLuint QOpenGLTextureCache::bindTexture(QOpenGLContext *context, qint64 key, const QImage &image)
 {
     GLuint id;
@@ -180,9 +180,7 @@ GLuint QOpenGLTextureCache::bindTexture(QOpenGLContext *context, qint64 key, con
 
     QImage tx = image.convertToFormat(QImage::Format_ARGB32_Premultiplied);
 
-    qgl_byteSwapImage(tx);
-
-    glTexImage2D(GL_TEXTURE_2D, 0, GL_RGBA, tx.width(), tx.height(), 0, GL_RGBA, GL_UNSIGNED_BYTE, const_cast<const QImage &>(tx).bits());
+    glTexImage2D(GL_TEXTURE_2D, 0, GL_BGRA_EXT, tx.width(), tx.height(), 0, GL_BGRA_EXT, GL_UNSIGNED_BYTE, const_cast<const QImage &>(tx).bits());
 
     int cost = tx.width() * tx.height() * 4 / 1024;
     m_cache.insert(key, new QOpenGLCachedTexture(id, context), cost);
-- 
1.8.3.2

